!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ytSearch=e()}(function(){return function n(a,l,r){function u(t,e){if(!l[t]){if(!a[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(o)return o(t,!0);throw(i=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",i}i=l[t]={exports:{}},a[t][0].call(i.exports,function(e){return u(a[t][1][e]||e)},i,i.exports,n,a,l,r)}return l[t].exports}for(var o="function"==typeof require&&require,e=0;e<r.length;e++)u(r[e]);return u}({1:[function(s,e,t){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var B=s("cheerio"),c=s("dasu");s("async.parallellimit");c.follow=!1,c.debug=!1;var i=s("./util.js"),d=i._getScripts,v=i._findLine,p=i._between,P=s("jsonpath"),h="Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html) (yt-search; https://www.npmjs.com/package/yt-search)",f=s("url"),a={};Object.keys(process.env).forEach(function(e){var t=process.env[e];if("0"==t||"false"==t||!t)return a[e]=!1;a[e]=t});var m=a.debug;function M(){m&&console.log.apply(this,arguments)}var l,y=s("querystring"),g=s("human-time"),L={YT:"https://youtube.com",SEARCH_MOBILE:"https://m.youtube.com/results",SEARCH_DESKTOP:"https://www.youtube.com/results"};function r(e,t){if(!t)return new Promise(function(i,n){r(e,function(e,t){return e?n(e):void i(t)})});var i="string"==typeof e?{query:e}:e;return i.userAgent&&(h=i.userAgent),i.search=i.query||i.search,i.original_search=i.search,i.videoId?function(e,a){M("fn: getVideoMetaData"),"string"==typeof e&&(t=e);"object"===n(e)&&(t=e.videoId);var t="https://www.youtube.com/watch?hl=en&gl=US&v="+t,t=f.parse(t);t.headers={"user-agent":h,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},t.headers["user-agent"]="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Safari/605.1.15",c.req(t,function(e,t,i){if(e)a(e);else{if(200!==t.status)return a("http status: "+t.status);var n;m&&(n=s("fs"),s("path"),n.writeFileSync("dasu.response",t.responseText,"utf8"));try{!function(e,t){M("_parseVideoInitialData"),e=d(e);var i=p(v(/ytInitialData.*=\s*{/,e),"{","}");if(!i)return t("could not find inital data in the html document");var n=p(v(/ytInitialPlayerResponse.*=\s*{/,e),"{","}");if(!n)return t("could not find inital player data in the html document");var a=JSON.parse(i),l=JSON.parse(n),r=P.value(a,"$..currentVideoEndpoint..videoId");if(!r)return t("video unavailable");if("ERROR"===P.value(l,"$..status")||"Video unavailable"===P.value(l,"$..reason"))return t("video unavailable");var u=P.value(a,"$..videoPrimaryInfoRenderer..title..text")||P.value(a,"$..videoPrimaryInfoRenderer..title..simpleText")||P.value(a,"$..videoPrimaryRenderer..title..text")||P.value(a,"$..videoPrimaryRenderer..title..simpleText")||P.value(a,"$..title..text")||P.value(a,"$..title..simpleText"),o=P.query(a,"$..description..text").join("")||P.query(l,"$..description..simpleText").join("")||P.query(l,"$..microformat..description..simpleText").join("")||P.query(l,"$..videoDetails..shortDescription").join(""),s=P.value(a,"$..owner..title..text")||P.value(a,"$..owner..title..simpleText"),c=P.value(a,"$..owner..navigationEndpoint..url")||P.value(a,"$..owner..title..url"),e="https://i.ytimg.com/vi/"+r+"/hqdefault.jpg",i=Y(function(e){var t="",i=Math.floor(e/36e5),n=Math.floor(e/6e4)%60,e=Math.floor(e/1e3)%60;i&&(t+=i+":");n&&(t+=n+":");String(e).length<2&&(t+="0");return t+=e}(1e3*Number(P.value(l,"$..videoDetails..lengthSeconds")))),n=P.value(a,"$..sentimentBar..tooltip").split(/[,.]/).join("").split(/\D+/),n=(Number(n[0]),Number(n[1]),P.value(a,"$..uploadDate")||P.value(a,"$..dateText..simpleText")),a=n&&g(new Date(n))||"",c={title:u,description:o,url:L.YT+"/watch?v="+r,videoId:r,seconds:Number(i.seconds),timestamp:i.timestamp,duration:i,views:Number(P.value(l,"$..videoDetails..viewCount")),genre:(P.value(l,"$..category")||"").toLowerCase(),uploadDate:k(n),ago:a,image:e,thumbnail:e,author:{name:s,url:L.YT+c}};t(null,c)}(i,a)}catch(e){a(e)}}})}(i.videoId,t):i.listId?function(e,a){M("fn: getPlaylistMetaData"),"string"==typeof e&&(t=e);"object"===n(e)&&(t=e.listId||e.playlistId);var t="https://www.youtube.com/playlist?hl=en&gl=US&list="+t,t=f.parse(t);t.headers={"user-agent":h,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},c.req(t,function(e,t,i){if(e)a(e);else{if(200!==t.status)return a("http status: "+t.status);var n;m&&(n=s("fs"),s("path"),n.writeFileSync("dasu.response",t.responseText,"utf8"));try{!function(e,t){M("fn: parsePlaylistBody");var i=(e=d(e)).match(/ytInitialData.*=\s*({.*});/)[1];if(!i)throw new Error("failed to parse ytInitialData json data");var n=JSON.parse(i),a=P.value(n,"$..microformat..urlCanonical").split("=")[1],e=P.value(n,"$..sidebar.playlistSidebarRenderer.items[0]..stats[1].simpleText").match(/\d+/),i=P.query(n,"$..playlistVideoListRenderer..contents")[0],l=[];i.forEach(function(e){var t=e,e=Y(P.value(t,"$..lengthText..simpleText")||P.value(t,"$..thumbnailOverlayTimeStatusRenderer..simpleText")||P.query(t,"$..lengthText..text").join("")||P.query(t,"$..thumbnailOverlayTimeStatusRenderer..text").join("")),t={title:P.value(t,"$..title..simpleText")||P.value(t,"$..title..text")||P.query(t,"$..title..text").join(""),videoId:P.value(t,"$..videoId"),listId:a,thumbnail:P.value(t,"$..thumbnail..thumbnails[0]..url").split("?")[0],duration:e,author:{name:P.value(t,"$..shortBylineText..runs[0]..text"),url:"https://youtube.com"+P.value(t,"$..shortBylineText..runs[0]..url")}};l.push(t)});n={title:P.value(n,"$..microformat..title"),listId:a,url:"https://youtube.com/playlist?list="+a,views:Number(e),date:function(e){M("fn: _parsePlaylistLastUpdateTime");for(var t=e.trim().split(/[\s.-]+/),i=0;i<t.length;i++){var n=t.slice(i),a=n.join(" "),n=n.reverse().join(" "),a=new Date(a),n=new Date(n);if("Invalid Date"!==a.toString())return k(a);if("Invalid Date"!==n.toString())return k(n)}return""}(P.value(n,"$..sidebar.playlistSidebarRenderer.items[0]..stats[2]..simpleText")||P.query(n,"$..sidebar.playlistSidebarRenderer.items[0]..stats[2]..text").join("")||""),image:l[0].thumbnail,thumbnail:l[0].thumbnail,videos:l,author:{name:P.value(n,"$..videoOwner..title..runs[0]..text"),url:"https://youtube.com"+P.value(n,"$..videoOwner..navigationEndpoint..url")}};t&&t(null,n)}(i,a)}catch(e){a(e)}}})}(i.listId,t):i.search?void function r(u,o){var e=y.escape(u.search).split(/\s+/);var t=u.hl||"en";var i=u.gl||"US";var n=u.category||"";var a=Number(u.pageStart)||1;var l=Number(u.pageEnd)||Number(u.pages)||1;a<=0&&(a=1)<=l&&(l+=1);Number.isNaN(l)&&o("error: pageEnd must be a number");u.pageStart=a;u.pageEnd=l;u.currentPage=u.currentPage||a;a="?";a+="search_query="+e.join("+");-1===a.indexOf("&hl=")&&(a+="&hl="+t);-1===a.indexOf("&gl=")&&(a+="&gl="+i);n&&(a+="&category="+n);u.sp&&(a+="&sp="+u.sp);a=L.SEARCH_DESKTOP+a;var a=f.parse(a);a.headers={"user-agent":h,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"};M(a);M("getting results: "+u.currentPage);c.req(a,function(e,t,i){if(e)o(e);else{if(200!==t.status)return o("http status: "+t.status);var n;m&&(n=s("fs"),s("path"),n.writeFileSync("dasu.response",t.responseText,"utf8"));try{I(i,function(e,t){if(e)return o(e);var i=t,n=i.filter(x),a=i.filter($),l=i.filter(b),e=i.filter(T),i=i.filter(w);u._data=u._data||{},u._data.videos=u._data.videos||[],u._data.playlists=u._data.playlists||[],u._data.channels=u._data.channels||[],u._data.live=u._data.live||[],u._data.all=u._data.all||[],n.forEach(function(e){u._data.videos.push(e)}),a.forEach(function(e){u._data.playlists.push(e)}),l.forEach(function(e){u._data.channels.push(e)}),e.forEach(function(e){u._data.live.push(e)}),i.forEach(function(e){u._data.all.push(e)}),u.currentPage++;a=u.currentPage<=u.pageEnd;a&&t._sp?(u.sp=t._sp,setTimeout(function(){r(u,o)},2500)):(l=u._data.videos.filter(x),e=u._data.playlists.filter($),i=u._data.channels.filter(b),a=u._data.live.filter(T),t=u._data.all.slice(w),o(null,{all:t,videos:l,live:a,playlists:e,lists:e,accounts:i,channels:i}))})}catch(e){o(e)}}})}(i,t):t(Error("yt-search: no query given"))}function x(e,t,i){if("video"!==e.type)return!1;var n=e.videoId;return i.findIndex(function(e){return n===e.videoId})===t}function $(e,t,i){if("list"!==e.type)return!1;var n=e.listId;return i.findIndex(function(e){return n===e.listId})===t}function b(e,t,i){if("channel"!==e.type)return!1;var n=e.url;return i.findIndex(function(e){return n===e.url})===t}function T(e,t,i){if("live"!==e.type)return!1;var n=e.videoId;return i.findIndex(function(e){return n===e.videoId})===t}function w(e,t,i){switch(e.type){case"video":case"list":case"channel":case"live":break;default:return!1}var n=e.url;return i.findIndex(function(e){return n===e.url})===t}function I(e,t){var i=/{.*}/,n=B.load(e),a=n("div#initial-data").html()||"";if(!(a=i.exec(a)||""))for(var l=n("script"),r=0;r<l.length;r++)n(l[r]).html().split("\n").forEach(function(e){for(;0<=(t=e.indexOf("ytInitialData"));){e=e.slice(t+"ytInitialData".length);var t=i.exec(e);t&&t.length>a.length&&(a=t)}});if(!a)return t("could not find inital data in the html document");var u=[],o=[],e=JSON.parse(a[0]),s=P.query(e,"$..itemSectionRenderer..contents.*");M("items.length: "+s.length);for(var c=0;c<s.length;c++){var d=s[c],v=void 0,p="unknown",h=d.compactPlaylistRenderer||d.playlistRenderer,f=d.compactChannelRenderer||d.channelRenderer,m=d.compactVideoRenderer||d.videoRenderer,y=h&&P.value(d,"$..playlistId"),h=f&&P.value(d,"$..channelId"),g=m&&P.value(d,"$..videoId"),f=P.query(d,"$..viewCountText..text").join(""),m="UPCOMING"===P.query(d,"$..thumbnailOverlayTimeStatusRenderer..style").join("").trim();g&&(p="video"),h&&(p="channel"),y&&(p="list"),(0<=f.indexOf("watching")||"LIVE"===P.query(d,"$..thumbnailOverlayTimeStatusRenderer..text").join("").trim()||m)&&(p="live");try{switch(p){case"video":var x=U(P.value(d,"$..thumbnail..url"))||U(P.value(d,"$..thumbnails..url"))||U(P.value(d,"$..thumbnails")),$=P.value(d,"$..title..text")||P.value(d,"$..title..simpleText"),b=P.value(d,"$..shortBylineText..text")||P.value(d,"$..longBylineText..text"),T=P.value(d,"$..shortBylineText..url")||P.value(d,"$..longBylineText..url"),w=P.value(d,"$..publishedTimeText..text")||P.value(d,"$..publishedTimeText..simpleText"),I=P.value(d,"$..viewCountText..text")||P.value(d,"$..viewCountText..simpleText")||"0",S=Number(I.split(/\s+/)[0].split(/[,.]/).join("").trim()),_=Y(P.value(d,"$..lengthText..text")||P.value(d,"$..lengthText..simpleText")||"0:00"),I=P.query(d,"$..description..text").join("")||P.query(d,"$..descriptionSnippet..text").join(""),v={type:"video",videoId:g,url:L.YT+"/watch?v="+g,title:$.trim(),description:I,image:x,thumbnail:x,seconds:Number(_.seconds),timestamp:_.timestamp,duration:_,ago:w,views:Number(S),author:{name:b,url:L.YT+T}};break;case"list":var S=U(P.value(d,"$..thumbnail..url"))||U(P.value(d,"$..thumbnails..url"))||U(P.value(d,"$..thumbnails")),b=P.value(d,"$..title..text")||P.value(d,"$..title..simpleText"),j=P.value(d,"$..shortBylineText..text")||P.value(d,"$..longBylineText..text")||P.value(d,"$..shortBylineText..simpleText")||P.value(d,"$..longBylineText..simpleTextn")||"YouTube",q=P.value(d,"$..shortBylineText..url")||P.value(d,"$..longBylineText..url")||"",T=P.value(d,"$..videoCountShortText..text")||P.value(d,"$..videoCountText..text")||P.value(d,"$..videoCountShortText..simpleText")||P.value(d,"$..videoCountText..simpleText")||P.value(d,"$..thumbnailText..text")||P.value(d,"$..thumbnailText..simpleText");v={type:"list",listId:y,url:L.YT+"/playlist?list="+y,title:b.trim(),image:S,thumbnail:S,videoCount:T,author:{name:j,url:L.YT+q}};break;case"channel":var D=U(P.value(d,"$..thumbnail..url"))||U(P.value(d,"$..thumbnails..url"))||U(P.value(d,"$..thumbnails")),E=P.value(d,"$..title..text")||P.value(d,"$..title..simpleText")||P.value(d,"$..displayName..text"),N=P.value(d,"$..shortBylineText..text")||P.value(d,"$..longBylineText..text")||P.value(d,"$..displayName..text")||P.value(d,"$..displayName..simpleText"),O=P.value(d,"$..videoCountText..text")||P.value(d,"$..videoCountText..simpleText")||"0",C=P.value(d,"$..subscriberCountText..text")||P.value(d,"$..subscriberCountText..simpleText");"string"==typeof C&&(C=C.split(/\s+/).filter(function(e){return e.match(/\d/)})[0]);var R=P.value(d,"$..navigationEndpoint..url")||"/user/"+E;v={type:"channel",name:N,url:L.YT+R,title:E.trim(),image:D,thumbnail:D,videoCount:Number(O.replace(/\D+/g,"")),videoCountLabel:O,subCount:function(e){if(!e)return;var t=e.split(/\s+/).filter(function(e){return e.match(/\d/)})[0].toLowerCase(),e=t.match(/\d+(\.\d+)?/);if(!e||!e[0])return;e=Number(e[0]);return 0<=t.indexOf("m")?1e6*e:0<=t.indexOf("k")?1e3*e:e}(C),subCountLabel:C};break;case"live":j=U(P.value(d,"$..thumbnail..url"))||U(P.value(d,"$..thumbnails..url"))||U(P.value(d,"$..thumbnails")),q=P.value(d,"$..title..text")||P.value(d,"$..title..simpleText"),N=P.value(d,"$..shortBylineText..text")||P.value(d,"$..longBylineText..text"),R=P.value(d,"$..shortBylineText..url")||P.value(d,"$..longBylineText..url"),E=P.query(d,"$..viewCountText..text").join("")||P.query(d,"$..viewCountText..simpleText").join("")||"0",D=Number(E.split(/\s+/)[0].split(/[,.]/).join("").trim()),O=P.query(d,"$..description..text").join("")||P.query(d,"$..descriptionSnippet..text").join(""),C=P.value(d,"$..upcomingEventData..startTime"),E=Date.now()>C?1e3*C:C,C=k(E);v={type:"live",videoId:g,url:L.YT+"/watch?v="+g,title:q.trim(),description:O,image:j,thumbnail:j,watching:Number(D),author:{name:N,url:L.YT+R}},E?(v.startTime=E,v.startDate=C,v.status="UPCOMING"):v.status="LIVE"}v&&o.push(v)}catch(e){M(e),u.push(e)}}e=P.value(e,"$..continuation");return o._ctoken=e,u.length?t(u.pop(),o):t(null,o)}function k(e){return e=new Date(e),M("fn: _toInternalDateString"),e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}function Y(e){var t=e.split(/\s+/),i=t[t.length-1].replace(/[^:.\d]/g,"");if(!i)return{toString:function(){return t[0]},seconds:0,timestamp:0};for(;i[i.length-1].match(/\D/);)i=i.slice(0,-1);for(var n=(i=i.replace(/\./g,":")).split(/[:.]/),a=0,l=0,r=n.length-1;0<=r;r--)if(!(n[r].length<=0)){var u=n[r].replace(/\D/g,"");if(a+=parseInt(u)*(0<l?Math.pow(60,l):1),2<++l)break}return{toString:function(){return a+" seconds ("+i+")"},seconds:a,timestamp:i}}function U(e){var t;return"string"!=typeof e?e.length?U(t=e[0]):void 0:0===(t=(t=(t=(t=e).split("?")[0]).split("/default.jpg").join("/hqdefault.jpg")).split("/default.jpeg").join("/hqdefault.jpeg")).indexOf("//")?"https://"+t.slice(2):t.split("http://").join("https://")}e.exports=r,e.exports.search=r,s.main===e&&(l="superman theme list pewdiepie channel",console.log("test: doing list search"),r({query:l,pageEnd:1},function(e,t){if(e)throw e;var i=t.videos,e=t.playlists,t=t.channels;console.log("videos: "+i.length),console.log("playlists: "+e.length),console.log("channels: "+t.length);for(var n=0;n<i.length;n++){var a=i[n],l=" (".concat(a.timestamp,")");console.log(a.title+l)}e.forEach(function(e){console.log("playlist: ".concat(e.title," | ").concat(e.listId))}),t.forEach(function(e){console.log("channel: ".concat(e.title," | ").concat(e.description))})}))},{"./util.js":2,"async.parallellimit":void 0,cheerio:void 0,dasu:void 0,fs:void 0,"human-time":void 0,jsonpath:void 0,path:void 0,querystring:void 0,url:void 0}],2:[function(e,t,i){"use strict";var l=e("cheerio"),e={};function r(e,t){var i=r.cache||{};(r.cache=i)[t]=i[t]||{};var n=i[t].lines||t.split("\n");i[t].lines=n,clearTimeout(i[t].timeout),i[t].timeout=setTimeout(function(){delete i[t]},100);for(var a=0;a<n.length;a++){var l=n[a];if(e.test(l))return l}return""}(t.exports=e)._getScripts=function(e){for(var t=l.load(e)("script"),i="",n=0;n<t.length;n++){var a=t[n],a=a&&a.children[0],a=a&&a.data;a&&(i+=a+"\n")}return i},e._findLine=r,e._between=function(e,t,i){t=e.indexOf(t),i=e.lastIndexOf(i);return t<0||i<0?"":e.slice(t,i+1)}},{cheerio:void 0}]},{},[1])(1)});